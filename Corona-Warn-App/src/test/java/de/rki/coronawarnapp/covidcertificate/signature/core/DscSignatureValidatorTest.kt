package de.rki.coronawarnapp.covidcertificate.signature.core

import de.rki.coronawarnapp.covidcertificate.DaggerCovidCertificateTestComponent
import de.rki.coronawarnapp.covidcertificate.common.certificate.DccQrCodeExtractor
import de.rki.coronawarnapp.covidcertificate.common.exception.InvalidHealthCertificateException
import de.rki.coronawarnapp.covidcertificate.common.exception.InvalidHealthCertificateException.ErrorCode.HC_DSC_OID_MISMATCH_RC
import de.rki.coronawarnapp.covidcertificate.common.exception.InvalidHealthCertificateException.ErrorCode.HC_DSC_OID_MISMATCH_TC
import de.rki.coronawarnapp.covidcertificate.common.exception.InvalidHealthCertificateException.ErrorCode.HC_DSC_OID_MISMATCH_VC
import de.rki.coronawarnapp.server.protocols.internal.dgc.DscListOuterClass
import okio.ByteString.Companion.decodeBase64
import org.junit.jupiter.api.BeforeEach
import org.junit.jupiter.api.Test
import testhelpers.BaseTest
import de.rki.coronawarnapp.util.toOkioByteString
import io.kotest.assertions.throwables.shouldNotThrow
import io.kotest.assertions.throwables.shouldThrow
import io.kotest.matchers.shouldBe
import javax.inject.Inject

@Suppress("MaxLineLength")
class DscSignatureValidatorTest : BaseTest() {

    @Inject lateinit var extractor: DccQrCodeExtractor

    @BeforeEach
    fun setup() {
        DaggerCovidCertificateTestComponent.factory().create().inject(this)
    }

    /**
     * Test cases https://github.com/corona-warn-app/cwa-app-tech-spec/blob/78009f7e3aa6aef56892caedcfe478bfb9d4d691/docs/spec/dgc-overview-client.md#sample-data-for-protocol-buffer-message-for-dsclist
     */

    @Test
    fun `validating tc=fail, vc=fail, rc=pass - forRCsWithOID`() {
        val rc =
            "HC1:6BFOXN*TS0BI\$ZD8UHB0O. BQODJZ3T.H8EMAD61:OLX8HOTGNATSJFOO%5OK1JZZPQA37S47*KB*KYQTHFT.T4RZ4E%5QK9-L9AHP61AVH9MK9FWPW*9945-V57KPF/9BL5-M1:HU6%EZY9 UP/KPP-E2317T1WMU9/9-3AKI62R6-.Q/FMUW6W*93KDW0K4OIMEDTJCJKDLEDL9C*XI9YI1VCSWC%PDB2MN9CJZI-.1DH8Z.C3C9S/F\$JDCHHZ4FNLE72MC.BPC9SC95C9PG9AWBBIK6IA8B5C3DGZK*9DJZI+EBR3E%JTQOL2009UVD0HX2JR\$46N3M0VU-N00S4T7LUFNXHBV7CV55:PV*BV*RRK49VF2E4FPNLX5ER0C-SV0W-BJV0SHE76:9Q.9DMRSL7:+BSSQO7ST2UAF9YOTQ%FYLJK+FNJB1FBL:OTYE.QRLJE:N7GP0M MNEV56JK J\$1DK30.EDX1"
        val vc =
            "HC1:6BFOXN*TS0BI\$ZD8UHB0O. BQODJZ3G*H1*S1RO4.S-OPA+I AR4O78WAH-3+PEF/8X*G-O9UVPQRHIY1VS1NQ1 WUQRELS4 CT1HFUZ2T4D%*400T:O02\$4G.4++K+*4KCTUZKQHNP.0:NN6AL**IJP0CG7ZK75KN+*4.\$S6ZCJKB0WJMD3IFTG23N:IN1MPF5RBQ746B46O1N646RM9AL5CBVW566LH 467PPDFPVX1R270:6NEQ0R6\$46*PP:+P*.18.0+Q6846276PR6KK9%OCUF5LDC+G9QJPNF67J6NV6KNJ62K WJOWEYIALEE-7A%IA%DA9MGF:F81H23DLEE+-C/DD1JAA/CY3O0JK1WL*50JFTMD3QHBZQJD DF9RWS1J71/GHM-E3/6ZCV. 6:86DT1KV18YMAN6PMHWEM++V.DB+VI5SJKFE%0NQP5\$9K0WTUBU.SU/KKI2NIETF9J-MQ30KKA6XN653AT3OC03PTDZZQ*RVNHFWX5J+AHCS%TS-%CCVALQ6.20PE163"
        val tc =
            "HC1:6BFOXN*TS0BI\$ZD8UHB0O. BQODJZ3G*HIXH1RO4.S-OPA+I0AR MJ.I5M8I3VDF/8X*G-O9UVPQRHIY1VS1NQ1 WUQRELS4HBT%GNQ\$SZ/K9Y4%*4J1T.M7\$XK7:4XTC8AL**IDHN0GV0NNJD7+*431TDYK\$SFCG7IRF+*4.\$S6ZC0JBEQJDG3LWTBGJM:IR1MPF5RBQ746B46O1N646RM9WC5-QU8462R60%MLEQA/9VXPZBIBTU5DERNUP0NPF6O.6/1V3EHG+6CYM9E67ZMZE9XY9-962R6U*9R.9GAINF6OE65TJLQ39VCW CQED LDA\$D6VCF9CZXIXVG5OD\$JCCKDU9D9AIXC5.Q69L6-96NV64GE+XUQJA5M9/ RIRIFPERM9QW2\$NICZU7LO.XIZSBMZI/XILVA HS08K6LKFHJSVB6DBBKBJZI+EBR3E%JTQOL2009UVD0HX2JR\$4*5G+YT-93R%GEAJN*8KYV533G.8+YVWDNHVVVGJQ%G4S899E9XT2LVC0JZCE62H0\$2*:91SN *1ZD5GUS-GM\$:NI5V:QJQ%B8I1HRLDO62TEBWJ.-7DGNVHQ2Q9EYV7WL8U9FXLZ4R..1+:Q\$*BA50SV0J1"

        val dscData1 = filterDscData("3seKUa2SxU0=")
        shouldThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(tc)) }
            .errorCode shouldBe HC_DSC_OID_MISMATCH_TC

        shouldThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(vc)) }
            .errorCode shouldBe HC_DSC_OID_MISMATCH_VC

        shouldNotThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(rc)) }
    }

    @Test
    fun `validating tc=pass, vc=pass, rc=pass - forAllDCCsNoOID`() {
        val tc =
            "HC1:6BFOXN*TS0BI\$ZD8UHRTHZDE+VJG\$L20IGP11RO4.S-OPA+IL9RJBJ.I5%8IB CF/8X*G-O9UVPQRHIY1VS1NQ1 WUQRELS4 CTYMFQ0JC4TY/KA:KU 4N*I+*4KCTVZK VN-IF9Y4U7024ONA8GJIZD5CC9T0HK3JCNNG.87/G9FH.+H-RI PQVW5/O16%HAT1Z%PSH99H6-F0+V9.T9D 9BTUJK52ZB1%RO.RMF4%-PDO8\$%HLD45UOFYB+Y3MD4BX3/IEKMAB+HWYHFNHJK5I\$HWVH+ZE6%PB+HJL8:+H/O1D.LLZH3W1YXLNQ1PJAJBINY96Q1LJAF518OI6S99K6QJ2BMA+12:LN9X7I16T35T:85BK*C6ZS4.P4 04SYAH+932QX/GYIALEE-7A%IA%DA9MGF:F81H23DOA6SC95C9 KE%+GKHGPTH-0OU518J3-E3GG3G103RCY6EBQS7ZC7/S99UJ STV24LTP\$2-XC/B2LID0U2:OSD.KYMN.*2YPAOZASH1WWVEVNIM5-AUJBC3HIR\$VWSNLXMKR4CN6YW7\$2S\$D7UZ1367S2QD\$TGVTP15IXCV/MO+3U*B2.7*F6GF8-C36DOB.H"
        val vc =
            "HC1:6BFOXN*TS0BI\$ZD8UHRTHZDE+VJG\$L20I5*S1RO4.S-OPA+IECR/QG.I5V3I\$3HNO4*J8/Y4F%CD 810H% 0R%0IGF5JNBPIAYU%Q3/IE.UI\$RU0OATX2 \$U%J6.RQYZQ H93R33VF/UIGSUNG6 UB6+NS0W84W5SI:TU+MMPZ5.T9.T1+ZEO\$HJUPY0BD-I/2DBAJDAJCNB-43 X4VV2 73-E3ND3DAJ-43C-4A+2XEN QT QTHC31M3.C3QOV4NN3F85QNCY0VZ01\$4G%89B9+HFUE9ZC59B9LW4G%89-8CNNQ7TT0HYE9/MV%2F3ZC54JS/S7*KT\$IK-J2 JDZT:1BPMIMIA*NIKYJHIKDBCLTSL1E.G0GBC9U9Z1J2WTGHV:JVPQNI97 RV5IJ*EF+M0NIV847HW8*IFZX8:Q60*7WN69N5OSD.1MFLA+XN-V1C 10WA-GV2\$R*\$1I+7X1G*PKDO8QNMDH4JGM4%FVX22KUCTOQN2/4K5ZBIR5TKO\$QV3VL:BP2-UD70P07:1"
        val rc =
            "HC1:6BFOXN*TS0BI\$ZD8UHRTHZDE+VJG\$LM0IE3NAD61:OLX8:PT3G4/+62XGZHFPV5-FJLF6EB9UM97H98\$QJEQ8999Q9E\$BLZIA9JQ-JPEB8IIV1J2TS49BGIIZ0KZPIL3UBC3GIIC0JRPIU9T +TWZJ\$7K+ CUED:NK-9C5QDUBJ6+Q4U77Q4UYQD*O%+Q.SQBDO4C53752HPPEPHCR7XB3DON95U/3UEEZ.C3C9S/F\$JDCHHZ4FNLE72MC.BPC9SC95C9PG9AWBKHK6IA8B5C3DGZKCWCJZI+EBR3E%JTQOL2009UVD0HX2JR\$46N3:2V72SQ\$90:P2UK1\$PYZH-R3BU9JD09-N+\$RO0Q2E40TTKKVH*J+ VFUBCVC84WR-RC02BUCUETUSFEIESZGTLRD2TNJB0\$AKY8OWFB M6PUBMR+\$B+PPGQT24FSQCHBK.IFSEUR02I3K6ID-109-KY1"

        val dscData1 = filterDscData("6LVeJLKcq3s=")
        shouldNotThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(tc)) }
        shouldNotThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(vc)) }
        shouldNotThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(rc)) }
    }

    @Test
    fun `validating tc=fail, vc=pass, rc=fail - forVCsWithOID`() {
        val tc =
            "HC1:6BFOXN*TS0BI\$ZD-PH.SGLV7ULO81K0IIQHK 43JUB/EB*PISOF.TM4 4582.5E/GPWBI\$C9UDBQEAJJKHHGEC8.-B97UI%KH NXCTP*OX-U8%M+T6/PKQ*NU/VC.UKMI%9TU09AFV8%MXLIZ6NE09S6DG+SB.V Q5 M9BOASJ0%YB9YP:OIG/QUZ4+FJE 4Y3LL/II 05B92V4X\$75-C5-C:NN:C9-HNRKIK2OC0IM5QM80T7UV:JA7SB%8R+BD-C/BCBFGIE9DFHW1HH4PUE9.IP6MIVZ0K:GAL2JL87T5+V9R LLZH3W1YXLNQ1PJAJBINY9:O1D.LGV5KNM.Z8M+8:Y001H%Y0C-96IJ5KD\$JDUKC+G8:CA7KE+-CT-C0DIR9CJZIR+1+SGP+P6OIB.VT*QNC2BFUF\$SU%BV NLDK-RQ2%KYZP8 FUL8W2BJH0NEQ:Q67ZMA\$6KNFZTBH34X+QTU7+0QD-R-N4-96C-R\$DP+77K PTU7815 HG5\$P- MD4W6:KETKPH77LNWIR2%I/ CDR2ACO7DS\$3R6*KF9PZ+IO57WARD5G4/IKXAP9LJCU:D2H PW07\$11-/M3N7P*EO+396O\$10.DAZ3"
        val vc =
            "HC1:6BFOXN*TS0BI\$ZD-PH.SGLV7ULO81K0II:Q5 43JUB/EB*PI%MF*CM4 4\$82:LC/GPWBI\$C9UDBQEAJJKHHGEC8.-B97UI%KH N:CS/RQV*Q8%MBU6 \$NEQKYUSC.UKMI*4CS5A8DR8%MXLIE09X4J4DRG+SB.V Q5NN9DQE-I0%YBUWM1RM8ZAUZ4+FJE 4Y3LL/II 0OC9SX0+*B85T%6213PPHN6D7LLK*2HG%89UV-0LZ 2MKN\$PV4IJZNV%IH*ON.KJBY41JP9B9+HFUE9ZC59B9LW4G%89-8CNNI:C2780OP/485:4N%2%R0O05L%2A550AT56D7OF\$W2AWCDZISP4*2DJFTU53/GNKL3ICGMJKQJK6HMXFQ%TEYDLM50168+03.GU1K2*/1+56D15LAHANAO25NFUZ+0NA2* LRIFZ1N3TILQ5LEW6-V \$2UG9LYO0NIYB6B*1-FF L4C%FKJBDRT63JXBH/%D*FCY/K3IM3G8Q8BZY5LXC26HF7UEZ6/JRZ00L/293"
        val rc =
            "HC1:6BFOXN*TS0BI\$ZD-PH.SGLV7ULO81KY72I:ID+4WFNJ59V2S2/D-RISGVGKO-MPW\$NLEENKE\$JDVPLW1KD0KSKE MCAOIC.U2VA0*PE I: KH NH8JY\$NR+PC.UKMI4.1*-37CPOQ6AYP1KQ7 O4A7E:7LYP9TQH99+EQHCRCU7BDL8FF0D9E2LBHHGKLO-K%FGMIA6EAYHILIIX2MCJJJGI1JAF.7%TTP+P6OIB.VT*QNC2BFUF\$SU%BO*N5PIBPIAOI5XIXCLZRE/DD-B5V12JFQ%P82%KYZP8 FUL8W2BJH0NEQ:Q67ZMA\$6ERRF2MM*S\$USU6E%03E.SDFT3VCWQTY8TC6U8/DQMC:Y3XEO KU+*CJ8OSDDM\$7W:RA+JZ\$J64OP+B4EN1KMOZVKZ0MTO0HL5VFZYI3260NRYYDZ7V8\$TANV0CW+P1:6U5XM+S5*3P6RV4\$DX-EB50B1KZ3"
        val dscData1 = filterDscData("ACkfCcHlSWY=")
        shouldThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(tc)) }
            .errorCode shouldBe HC_DSC_OID_MISMATCH_TC

        shouldNotThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(vc)) }

        shouldThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(rc)) }
            .errorCode shouldBe HC_DSC_OID_MISMATCH_RC
    }

    @Test
    fun `validating tc=fail, vc=fail, rc=pass - forRCsWithOIDWithZero`() {
        val tc =
            "HC1:6BFOXN*TS0BI\$ZDYSH7 GN3URTAA/J09909G3XHP+56R5.C98 FKHR2I2V69LDM:UC*GP-S4FT5D75W9AV88E34L/5R3F9JA+/BA2A7DA-B9FJC4JB*NLN:FRJCBLEH-BEQNV5GEPD+AHOKEH-BDPLXAOITK8KES/F-1JZ.K KMKHGX2MWY8FF9%TT0QIRR97I2HOAXL92L0A KPLIO4KRK4WPE-L95*B7\$KZ ROA9MFVY589XQJ00Y2F9.4GRHFJ1.6O8:3\$M8I05*\$KLZOGN8ORC0%KD\$S3B9%H04DKQ7TS.8WA4G5TE68WLDA\$D6VCF9CZXIXVG5OD\$JCCKDMKC9AIXC5.Q69L6-96NV64GEWPEQJA5M9EYJ2YU+LHXT2NTICZUV4S6PP+ 5-PP:G9XF5-JU04AXIQM P7-5AQ5SW5PK95%L//6JWE/.Q100R\$FTM8*N9TL2-163:UNE0D%P*LK.QGNZ7FP8RZJ-E4ZE4Z0Q%JG4/N2E4F2G0ZER7FA/B:V26-EYNT-IQU 1:9L-HV2*AVWC3XUUXNOX8LWNP2SKW8\$AJTARXIH72KOUD+:JFBSOKP\$.UZ%E77UZFH-M7T%NGUURI311B\$EI"
        val vc =
            "HC1:6BFOXN*TS0BI\$ZDYSH7 GN3URTAA/J769V0M3XHP+56R5.C9C+FKHR2I2579JCBMF6.UCSMIF0JEYI1DLNCKUCII7JSTNR95.16/.49/5K:7B95+16:Y5-XK2 7T35V.4SA7G6MT0QQNQU0PT/5+Y5ET4G.PDT4J/RJHP-7P4A7E:7LYPPTQ7XB/DOPCRXS40 LHZA0D9E2LBHHGKLO-K%FGLIA5D8MJKQJK JMDJL9GG.IA-D81REMDB Y8Q-B/.DV2MGDIK3M260/43/43O057%S/U456L7Y48YIZ73423%JGMR6PK95-0BR7IWMVP4E:7J/M6V82M7YA7B9RT9MZS4: KWP4BD7JK8+GOR.OQ/3.MHN.7R 4JEK09T+E80*3G60QGK.FKUFGN+7D 0W1K19076SEFGE3S*Z10ZV+CH:9R-/LZJV:3K/4B.OL/B9U:41FDF2JZ1NM6V.0WT.QDX5L.V80KYPA+2O/\$J4EB-:T -JHEL.Z6C%63ZGPZL9AWRMP+\$2I/7BV5W%F"
        val rc =
            "HC1:6BFOXN*TS0BI\$ZDYSH7 GN3URTAA/J-9H9M9ESIGUBA KN9ULME5B9\$-VO-T5VC9:BPCNJINQ+MN/Q19QE8QEA7IB65C96LF2OLOKD%EDMIA+/B1REL+9G.CHFE6LF3E9I6JL9EV9E4JBJE9PWMV6I77LV9EZI9\$JAQJKSIJX2M KMKHKEJCY SA KZ*U0I1-I0*OC6H0/VMR\$M4Q5%H0AN8SJ06YB-TI\$*SUFKVD9O-OEF82E9GX8\$G10QVGB3O1KO-OAGJM*K9B9\$EDU.MZ 2-B5O426JK43MTDC KE%+GKHGPTH-0OU518J3-E3GG3J20%76+.1/S6NGUN\$6A0F731QN1 I1B*U6T1/QUPB1C+659EQGJRMS/5Q1F1YSEJK734CC.FR.06ELE*50KQT-R5XM.%78+L+F8ZZCC5LRR9CONWRC%0DBNLR6H2RIG 2RAUALFXOSVDPUBO*YO9\$6%LBK8E"
        val dscData1 = filterDscData("GEXba2UJLGM=")
        shouldThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(tc)) }
            .errorCode shouldBe HC_DSC_OID_MISMATCH_TC

        shouldThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(vc)) }
            .errorCode shouldBe HC_DSC_OID_MISMATCH_VC

        shouldNotThrow<InvalidHealthCertificateException> { validator().validateSignature(dscData1, dccData(rc)) }
    }

    private fun dccData(tc: String) = extractor.extract(tc).data
    private fun filterDscData(kid: String): DscData = DscData(dscData.dscList.filter { it.kid == kid })
    private fun validator() = DscSignatureValidator()

    companion object {
        private const val DSC_LIST_BASE64 =
            "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"
        private val dscList: DscListOuterClass.DscList =
            DscListOuterClass.DscList.parseFrom(DSC_LIST_BASE64.decodeBase64()!!.toByteArray())
        private val dscData = DscData(
            dscList.certificatesList.map {
                DscItem(
                    it.kid.toOkioByteString().base64(),
                    it.data.toOkioByteString()
                )
            }
        )
    }
}
